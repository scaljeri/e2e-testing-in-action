<!doctype html>

<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="main.css">
    <link href='https://fonts.googleapis.com/css?family=Antic' rel='stylesheet' type='text/css'>
</head>

<body>
<main>
    <header>
        <div class="wrapper">
            <img src="images/protractor-selenium.png">

            <h1>E2E testing in Action</h1>

            <div class="horizontal-wrapper">
                <img src="images/icon-browserstack.png">
                <img src="images/mocha-icon.svg">
            </div>
        </div>
    </header>

    <article>
        <div class="content-container">
            <div class="content">
                If you kick off some tests in selenium or protractor chances are that they run smoothly in one browser
                but not even start in the other.
                The reason for that can be anything and more often than not, hard to solve. That is why I started
                <a href="https://github.com/scaljeri/selenium-protractor-browserstack">this</a> project on GitHub to
                demonstrate how you can use Selenium, Protractor or WebdriverIO with different test runners, assertion
                libraries and browsers running tests locally, remote or even in parallel.
                <br>
                But before I begin first follow the steps described in the project's <a href="https://github.com/scaljeri/selenium-protractor-browserstack">README</a>
                to get everything up and running.
            </div>


            <h2>Basic Authentication</h2>
            <div class="content first-dark-red">
                To login to the demo website you have to deal with Basic Authentication first. As you might already know Selenium
                cannot control the native popup you get with basic auth. In my search to solve this I found two solution which
                overcome these shortcomings. <br><br>

                The most easiest solution is to add the username and password to the url

                <pre style='color:#000020;background:#f6f8ff;'>http://foo:bar@localhost</pre>

                That's it, BUT not for Firefox, they have an addition popup

                <img src="images/extra-popup.png">
                <br>

                Fortunately this popup can be disabled with the config property <strong>network.http.phishy-userpass-length</strong>.
                For that to work with Selenium, you have to use <a href="https://github.com/SeleniumHQ/selenium/wiki/FirefoxDriver" target="_blank">Firefox profiles</a>,
                which you can see in action <a href="https://github.com/scaljeri/selenium-protractor-browserstack/blob/master/src/utils/driver.js#L68" target="_blank">here</a>.
                <br><br>
                But it is also possible to handle the authentication with NodeJS, before Selenium takes over, but it requires a different setup.
                The site itself should be public and the authentication part protected. After you've authenticated a redirect will bring you
                to your public site, but with some kind of authentication token appended to the url. In such case you can do the authentication with
                NodeJS followed by Selenium which uses this redirect url as its entry point. You can see the NodeJS part in action
                <a href="https://github.com/scaljeri/selenium-protractor-browserstack/blob/master/src/selenium.js#L62" target="_blank">here</a>.

            </div>

            <h2>Local testing</h2>
            <div class="content first-dark-blue">
                There is only one test case in this project, which looks more or less like
                <a href="https://github.com/scaljeri/e2e-testing-in-action/blob/master/tests/home.spec-protractor.js">this</a>

                <pre style='color:#000020;background:#f6f8ff;'>expect<span style='color:#308080; '>(</span>HomePo<span
                        style='color:#308080; '>.</span>title<span style='color:#308080; '>)</span><span
                        style='color:#308080; '>.</span>toEqual<span style='color:#308080; '>(</span><span
                        style='color:#800000; '>'</span><span style='color:#1060b6; '>Hello world!</span><span
                        style='color:#800000; '>'</span><span style='color:#308080; '>)</span><span
                        style='color:#406080; '>;</span></pre>
                <br>
                And there is also a <a href="https://github.com/scaljeri/e2e-testing-in-action/blob/master/tests/home.spec-mocha.js">chai/should</a> and
                <a href="https://github.com/scaljeri/e2e-testing-in-action/blob/master/tests/features/title.feature">cucumber</a> variant.

                I admit, not very spectacular, but it serves its purpose very well :)


                <h3>NodeJs</h3>
                To run this test with pure nodeJs

                <pre style='color:#000020;background:#f6f8ff;'>$<span style='color:#308080; '>></span> .<span
                        style='color:#308080; '>/</span>node_modules<span style='color:#308080; '>/</span>.bin<span
                        style='color:#308080; '>/</span>babel<span style='color:#308080; '>-</span>node .<span
                        style='color:#308080; '>/</span>src<span style='color:#308080; '>/</span>selenium<span
                        style='color:#008c00; '>.</span>js</pre>

                To simplify things a bit most commands are added to
                <a href="https://github.com/scaljeri/selenium-protractor-browserstack/blob/master/package.json#L29" target="_blank">package.js</a>.
                The above command can be shortened to

                <pre style='color:#000020;background:#f6f8ff;'>$<span style='color:#308080; '>></span> yarn start</pre>
                <a href="https://github.com/scaljeri/e2e-testing-in-action/blob/master/src/selenium.js#L62" target="_blank">Code</a>

                <h3>Selenium</h3>
                To run selenium you need to define the browser you want to use for testing

                <pre style='color:#000020;background:#f6f8ff;'>$<span style='color:#308080; '>></span> yarn start <span style='color:#308080; '>--</span> <span style='color:#308080; '>--</span>browse<span style='color:#308080; '>=</span>chrome</pre>

                This will only work if you have the browser driver available. If you want to use a selenium standalone server run the command as follows

                <pre style='color:#000020;background:#f6f8ff;'>$<span style='color:#308080; '>></span> yarn start <span style='color:#308080; '>--</span> <span style='color:#308080; '>--</span>browse<span style='color:#308080; '>=</span>chrome <span style='color:#308080; '>--</span>selenium<span style='color:#308080; '>-</span>standalone</pre>

                <a href="https://github.com/scaljeri/selenium-protractor-browserstack/blob/master/src/selenium.js#L42" target="_blank">Code</a>.

                <h3>Mocha</h3>
                The Mocha tests can be run as follows

                <pre style='color:#000020;background:#f6f8ff;'>$<span style='color:#308080; '>></span> yarn mocha <span style='color:#308080; '>--</span> <span style='color:#308080; '>--</span>browse chrome
$<span style='color:#308080; '>></span> yarn mocha <span style='color:#308080; '>--</span> <span style='color:#308080; '>--</span>browser firefox <span style='color:#308080; '>--</span>browser<span style='color:#308080; '>-</span>version <span style='color:#008c00; '>51</span></pre>

                I run mocha <a href="https://github.com/mochajs/mocha/wiki/Using-mocha-programmatically" target="_blank">programmatically</a> which gives
                you more control over what is happening as can be seen
                <a href="https://github.com/scaljeri/e2e-testing-in-action/blob/master/src/mocha.js" target="_blank">here</a>.

                <h3>Protractor</h3>
                With protractor things get easier, it can start the selenium server for you. So the only thing you have to type is

                <pre style='color:#000020;background:#f6f8ff;'>$<span style='color:#308080; '>></span> yarn protractor <span style='color:#308080; '>--</span> <span style='color:#308080; '>--</span>browse chrome
$<span style='color:#308080; '>></span> yarn protractor <span style='color:#308080; '>--</span> <span style='color:#308080; '>--</span>browser firefox <span style='color:#308080; '>--</span>browser<span style='color:#308080; '>-</span>version <span style='color:#008c00; '>51</span> <span style='color:#308080; '>--</span>cucumber</pre>

                The first example runs the <a href="https://github.com/scaljeri/e2e-testing-in-action/blob/master/tests/home.spec-protractor.js">jasmine specs</a>
                while the second runs <a href="https://github.com/scaljeri/e2e-testing-in-action/blob/master/tests/features/title.feature">cucumber tests</a>

                <h3>WebdriverIO</h3>
                WebdriverIO supports the same options as Protractor

                <pre style='color:#000020;background:#f6f8ff;'>$<span style='color:#308080; '>></span> yarn wdio <span style='color:#308080; '>--</span> <span style='color:#308080; '>--</span>browser firefox <span style='color:#308080; '>--</span>browser<span style='color:#308080; '>-</span>version <span style='color:#008c00; '>51</span> <span style='color:#308080; '>--</span>cucumber</pre>


                With the current version of Protractor and WebdriverIO you don't need to use firefox profiles anymore in order to
                solve the issue with basic auth, its all taken care of now! <br><br>
                WebdriverIO also comes with a handy tool called <strong>./node_modules/.bin/wdio</strong> which can
                setup the configuration file and
                run the specs with a lot of interesting options. Furthermore, in contrast to selenium and protractor,
                WebdriverIO transforms all
                actions to act synchroniously, for example

                <pre style='color:#000020;background:#f6f8ff;'>browser<span style='color:#008c00; '>.</span>getText<span
                        style='color:#308080; '>(</span><span
                        style='color:#595979; '>'h1') === 'Hello world!'</span></pre>
                It is also available for angular with <a
                    href="http://webdriver.io/guide/plugins/webdriverjs-angular.html">webdriverjs-angular</a>. It
                waits for angular to be ready, but they haven't enhanced it with angular specific commands as the
                developers think that functional tests
                should be as framework-agnostic as possible.
            </div>

            <h2>Remote testing with Browserstack</h2>
            <div class="content first-dark-red">
                With your Browserstack automation credentials you can now run your tests in the cloud. The only thing
                that is added to the configuration of Protractor and Webdriver IO is

                <pre style='color:#000020;background:#f6f8ff;'>export<span style='color:#008c00; '>.</span>config <span
                        style='color:#308080; '>=</span> {
    browserstackUser: myName,
    browserstackKey: myAccessKey,
    ...
    capabilities: {
        <span style='color:#595979; '>'browserstack.local': true,</span>
        <span style='color:#595979; '>'browserstack.debug': 'true'</span>
        ...
    }
    ...
}
</pre>

                Note that the configuration can change a bit depending on the tooling. To test the demo site on
                browserstack you need to add
                <strong>--browserstack-user</strong> <strong>name</strong> and <strong>--browserstack-key</strong>
                <strong>access-key</strong>
                argument to the above commands and the tests will auto-magically run on browserstack :)
                If it is a bit too much for you to add these to every command, you can also use environment variables

                <pre style='color:#000020;background:#f6f8ff;'>$<span style='color:#308080; '>></span> export BROWSERSTACK_USERNAME<span
                        style='color:#308080; '>=</span>name
$<span style='color:#308080; '>></span> export BROWSERSTACK_ACCESS_KEY<span style='color:#308080; '>=</span>access-key
</pre>


                Here is an example how selenium can be started
                <pre style='color:#000020;background:#f6f8ff;'>$<span style='color:#308080; '>></span> yarn start <span
                        style='color:#308080; '>-</span><span style='color:#308080; '>-</span> <span
                        style='color:#308080; '>-</span><span style='color:#308080; '>-</span>browser ie <span
                        style='color:#308080; '>-</span><span style='color:#308080; '>-</span>browser<span
                        style='color:#308080; '>-</span>version<span style='color:#308080; '>=</span><span
                        style='color:#008c00; '>9</span>
                <span style='color:#308080; '>-</span><span style='color:#308080; '>-</span>os<span
                            style='color:#308080; '>=</span>windows <span style='color:#308080; '>-</span><span
                            style='color:#308080; '>-</span>os<span style='color:#308080; '>-</span>version<span
                            style='color:#308080; '>=</span><span style='color:#008c00; '>7</span>
                <span style='color:#308080; '>-</span><span style='color:#308080; '>-</span>browserstack<span
                            style='color:#308080; '>-</span>user barfoo <span style='color:#308080; '>-</span><span
                            style='color:#308080; '>-</span>browserstack<span style='color:#308080; '>-</span>key liufo7ag4</pre>

                Checkout Browserstack to see what operating systems, devices and browsers are supported.
                Furthermore, as you might have noticed, running tests locally with Firefox is a true nightmare, but not on
                Browserstack, apparently they fixed all that. They even fixed that Firefox issue with Basic Authentication.
            </div>

            <h2>Parallel testing</h2>
            <div class="content first-dark-blue">
                In Protractor parallel sessions are controlled by a couple of arguments. First, with <strong>maxSessions</strong>
                you can define the total amount of browser used to run the tests. With <strong>maxInstances</strong>
                you can control the total amount of browsers per capability. Finally, the <strong>shardTestFiles</strong> property
                lets you share spec files between browser instances, which is good for performance

                <pre style='color:#000020;background:#f6f8ff;'>exports<span style='color:#308080; '>.</span>config <span style='color:#308080; '>=</span> <span style='color:#406080; '>{</span>
    <span style='color:#308080; '>.</span><span style='color:#308080; '>.</span><span style='color:#308080; '>.</span>
    maxSessions<span style='color:#406080; '>:</span> <span style='color:#308080; '>-</span><span style='color:#008c00; '>1</span> <span style='color:#595979; '>// unlimited</span>

   multiCapabilities<span style='color:#406080; '>:</span> <span style='color:#308080; '>[</span><span style='color:#406080; '>{</span>
           browserName<span style='color:#406080; '>:</span> <span style='color:#800000; '>'</span><span style='color:#1060b6; '>chrome</span><span style='color:#800000; '>'</span><span style='color:#308080; '>,</span>
           shardTestFiles<span style='color:#406080; '>:</span> <span style='color:#0f4d75; '>true</span><span style='color:#308080; '>,</span>
           maxInstances<span style='color:#406080; '>:</span> <span style='color:#008c00; '>10</span>
       <span style='color:#406080; '>}</span><span style='color:#308080; '>,</span>
       <span style='color:#406080; '>{</span>
           browserName<span style='color:#406080; '>:</span> <span style='color:#800000; '>'</span><span style='color:#1060b6; '>edge</span><span style='color:#800000; '>'</span><span style='color:#308080; '>,</span>
           shardTestFiles<span style='color:#406080; '>:</span> <span style='color:#0f4d75; '>true</span><span style='color:#308080; '>,</span>
           maxInstances<span style='color:#406080; '>:</span> <span style='color:#008c00; '>2</span>
       <span style='color:#406080; '>}</span><span style='color:#308080; '>]</span><span style='color:#308080; '>,</span>
      <span style='color:#308080; '>.</span><span style='color:#308080; '>.</span><span style='color:#308080; '>.</span>
<span style='color:#406080; '>}</span><span style='color:#406080; '>;</span></pre>
            </div>

            WebdriverIO has a slightly different configuration for parallel testing

            <pre style='color:#000020;background:#f6f8ff;'>exports<span style='color:#308080; '>.</span>config <span style='color:#308080; '>=</span> <span style='color:#406080; '>{</span>
   <span style='color:#308080; '>.</span><span style='color:#308080; '>.</span><span style='color:#308080; '>.</span>
   maxInstances<span style='color:#406080; '>:</span> <span style='color:#008c00; '>10</span>

   capabilities<span style='color:#406080; '>:</span> <span style='color:#308080; '>[</span><span style='color:#406080; '>{</span>
           browserName<span style='color:#406080; '>:</span> <span style='color:#800000; '>'</span><span style='color:#1060b6; '>chrome</span><span style='color:#800000; '>'</span><span style='color:#308080; '>,</span>
           maxInstances<span style='color:#406080; '>:</span> <span style='color:#008c00; '>10</span>
       <span style='color:#406080; '>}</span><span style='color:#308080; '>,</span>
       <span style='color:#406080; '>{</span>
           browserName<span style='color:#406080; '>:</span> <span style='color:#800000; '>'</span><span style='color:#1060b6; '>edge</span><span style='color:#800000; '>'</span><span style='color:#308080; '>,</span>
           maxInstances<span style='color:#406080; '>:</span> <span style='color:#008c00; '>2</span>
       <span style='color:#406080; '>}</span><span style='color:#308080; '>]</span><span style='color:#308080; '>,</span>
      <span style='color:#308080; '>.</span><span style='color:#308080; '>.</span><span style='color:#308080; '>.</span>
<span style='color:#406080; '>}</span><span style='color:#406080; '>;</span></pre>

            <h2>Available CLI options</h2>
            <div class="content">
                During this project the amount of configuration options has increased to a serious amount. They are all defined
                inside <a href="https://github.com/scaljeri/e2e-testing-in-action/blob/master/tests/config.js">config.js</a>
                But I've listed the most important ones below
                <br><br>

                <table>
                    <tr>
                        <td><b>--browser name</b></td><td>Name of the browser to be used for testing</td>
                    </tr>
                    <tr>
                        <td><b>--browserstack-key access-key</b></td><td>The access-key of the Browserstack account</td>
                    </tr>
                    <tr>
                        <td><b>--browserstack-user username</b></td><td>The username of the Browserstack account</td>
                    </tr>
                    <tr>
                        <td><b>--browser-version number</b></td><td>Browser version</td>
                    </tr>
                    <tr>
                        <td><b>--cucumber</b></td><td>Run cucumber feature tests (only for WebdriverIO and Protractor)</td>
                    </tr>
                    <tr>
                        <td><b>--max-instances number</b></td><td>Max amount of browser instances for one capability</td>
                    </tr>
                    <tr>
                        <td><b>--max-sessions number</b></td><td>Total amount of browser instances for all capabilities</td>
                    </tr>
                    <tr>
                        <td><b>--os name</b></td><td>Name of the operating system (Browserstack only)</td>
                    </tr>
                    <tr>
                        <td><b>--os-version number</b></td><td>Version of the OS (browserstack only)</td>
                    </tr>
                    <tr>
                        <td><b>--selenium-standalone</b></td><td>Use selenium standalone (Note that you have to start the server yourself!)</td>
                    </tr>
                </table>
            </div>

            <h2>Conclusion</h2>
            <p class="content first-dark-red">
                Considering all the work you have to do to get testing on your local machine up and running, I advice to
                use Browserstack. They have and will solve all the issue that can possibly happen. Like they did with
                Basic authentication. Local testing is of course faster, and should probably be the only reason why you want to do it.
                <br><br>
                Furthermore, considering the testing frameworks I've used in this project, <a href="http://webdriver.io/">WebdriverIO</a> is the big winner.
                They take away all the pain with their <strong>wdio</strong> command line tool, its awesome. But the biggest advantages is that everything
                is done synchronously.
            </p>
        </div>
    </article>
</main>
<script>
    var header = document.querySelector('header'), isMinified = false;

    window.onscroll = function (event) {
        if (window.pageYOffset > 100) {
            if (!isMinified) {
                header.classList.add('minified');
                isMinified = true;
            }
        } else if (isMinified) {
            header.classList.remove('minified');
            isMinified = false;
        }
    }
</script>
</body>
</html>
